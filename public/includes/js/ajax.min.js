function ajaxDirect(e,t,s="",o="No",a="post",n=e+"-process"){if(!0===debug&&console.log("ajax-init~"+n),"no"===o||"No"===o){$(".spinner").html(' <i class="la la-circle-o-notch la-spin" id="spinner"></i> Please wait ...'),$('button, input[type="submit"]').attr("disabled","true")}return $.ajax({data:t,type:a,url:site_url+"ajax.php?process="+n,success:function(t){let s;try{s=JSON.parse(t)}catch(e){s=t}if(!0===debug&&console.log(s),"logged-off"===s.error)return location.reload(),!1;dyn_functions[e](s)},error:function(t,s,o){let a;try{a=JSON.parse(t.responseText)}catch(e){a=t.responseText}if(!0===debug&&console.log(a),"logged-off"===a.error)return location.reload(),!1;dyn_functions[e](a)},complete:function(){"no"!==o&&"No"!==o||($('button, input[type="submit"]').prop("disabled",!1),$("#spinner").remove())}}),!1}function ajaxUpload(e,t,s="",o="No",a="post",n=e+"-process"){const r=$('form[name="'+s+'"]'),i=$(this).data("reset"),l=t.get("filename");return $("#progbarWidth").width(0),$.ajax({data:t,cache:!1,contentType:!1,processData:!1,timeout:6e4,type:a,url:site_url+"ajax.php?process="+n,xhr:function(){return myXhr=$.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(e){if(e.lengthComputable){let t=e.loaded/e.total*100;console.log("uploading "+l+" "+t.fixedToTwo()+"%"),$("#"+l+"-box .upload span").html("Uploading: "+t.toFixed(0)+"%"),$("progress").attr({value:e.loaded,max:e.total})}},!1),myXhr},success:function(t){let s;try{s=JSON.parse(t)}catch(e){s=t}!0===debug&&console.log(s),dyn_functions[e](s),"no"!==o&&"No"!==o||($('button, input[type="submit"]').prop("disabled",!1),$("#spinner").remove()),"yes"===i&&$(r)[0].reset(),$(r).next(".message").next("#progress").hide("fast")},error:function(t){let s;try{s=JSON.parse(t.responseJSON)}catch(e){s=t.responseJSON}!0===debug&&console.log(s),dyn_functions[e](s)},complete:function(){}}),$(r).next(".message").after("<div id='progress'><div id='progbarWidth'></div></div>"),!1}const ajaxFetch=(e="post",t,s={},o={})=>{t=site_url+"ajax.php?process="+t+"-process";const a=new FormData;for(let e in s)a.append(e,s[e]);return o.method=e,o.body=a,new Promise((e,s)=>{fetch(t,o).then(e=>e.json()).then(t=>{e(t)}).catch(e=>s(e))})};$(document).ready(function(){$("body").on("submit","form.o1",function(e){e.preventDefault();var t=$(this),s=$(this).attr("name")+"-process",o=$(this).data("redirect"),a=$(this).data("reset");return $(t).find(".message").html('<img src="'+site_url+'resources/images/waiting.gif" class="mx-auto d-block" width="80">'),$(t).find('input[type="submit"]').prop("disabled",!0),$.ajax({data:t.serialize(),type:t.attr("method"),url:site_url+"ajax.php?process="+s,success:function(e){!0===debug&&console.log("response: "+e);var s=JSON.parse(e);"success"===s.status&&"yes"==a&&($(t)[0].reset(),void 0!==s.response_id&&void 0!==o&&(o+="&id="+s.response_id)),$(t).find(".message").show(1e3).html('<span class="alert alert-'+s.status+' d-block">'+s.message+"</span>"),"success"===s.status&&void 0!==o&&setTimeout(function(e){window.location.href=o},2e3),$(t).find('input[type="submit"]').prop("disabled",!1)},error:function(e,t,s){},complete:function(){}}),!1}),$("body").on("submit","form.api",function(e){e.preventDefault();var t=$(this),s=t.serialize(),o=($(this).attr("action"),$(this).attr("method")),a=$(this).data("reset"),n=$(this).data("popup"),r=$(this).data("scroll"),i=($(this).data("validate"),$(this).data("function"),$(this).data("aftersuccess")),l=$(this).attr("name")+"-process";$(this).data("targetele"),$("#booking_id").val();return $(t).next(".message").slideDown().html('<img src="'+site_url+'resources/images/waiting.gif" class="mx-auto d-block" width="80">'),$(t).find("input#submitBtn").prop("disabled",!0),$.ajax({data:s,type:o,url:site_url+"ajax.php?process="+l,success:function(e){!0===debug&&console.log(e),window.innerWidth>800&&$("label[data-toggle='popover']").popover({trigger:"hover"});var o=JSON.parse(e);"yes"!==n?($(t).closest("div").find(".message").slideDown().html('<span class="text-'+o.status+'">'+o.message+"</span>"),"yes"===r&&$("html, body").animate({scrollTop:$(t).closest("div").find(".message").offset().top-68},800)):($(t).closest("div").find(".message").html(""),$("#bookingSuccessModal .modal-body").html(o.message),$("#bookingSuccessModal").modal("toggle")),void 0!==i&&""!==i&&"success"==o.status&&(console.log(o.refID),console.log("mail init"),$.ajax({data:s+"&refID="+o.refID+"&fare="+o.fare,type:"POST",url:site_url+"ajax.php?process="+i+"-process",success:function(e){!0===debug&&(console.log(s),console.log(e)),emailres=JSON.parse(e),"danger"==emailres.status?($("#bookingSuccessModal .modal-body").html('<span class="text-'+emailres.status+'">'+emailres.message+"</span>"),($("#bookingSuccessModal").data("bs.modal")||{})._isShown||$("#bookingSuccessModal").modal("toggle")):"success"==emailres.status&&!0===debug&&console.log("mail sent")},error:function(e,t,s){},complete:function(){}})),"yes"==a&&($(t)[0].reset(),$("form")[0].reset(),$("#fares").slideUp(function(){$("#package-fare").html(""),$("#fareEstLabel").html(""),$("#fareDetLabel").html(""),$('input[name="fare"]').val("")}),$(".nb_optional").show(),$("#fares_nb").attr("type","checkbox").val(),$("#fares_nb").prop("checked",!1)),datetimeinit(),telephone(),$("#telephone").intlTelInput("setCountry","lk"),imgtosvg(),$(t).find("input#submitBtn").prop("disabled",!1)},error:function(e,t,s){},complete:function(){}}),!1}),$("body").on("submit","form.cancelBooking",function(e){e.preventDefault();var t=$(this).attr("method"),s=$(this).attr("name")+"-process",o=$(this);return $(o).find(".message").html(""),!!confirm("Are you sure want to cancel the booking?")&&($.ajax({data:o.serialize(),type:t,url:site_url+"ajax.php?process="+s,success:function(e){var t=JSON.parse(e);1==t.success?(!0===debug&&console.log("Booking Cancelled"),$("#status").addClass("text-danger").html("Cancelled"),$("button#cancel-booking").remove(),$("#cancel-conf-modal").modal("hide")):t.hasOwnProperty("msg")?$(o).find(".message").html(t.msg):$(o).find(".message").html("Cancellation failed! Please make sure the phone number entered was used when making the booking.")},error:function(e,t,s){},complete:function(){}}),!1)}),$("form.uploads").on("submit",function(e){function t(e){if(e.lengthComputable){var t=parseInt(e.loaded/e.total*100);$("#progress #progbarWidth").text(t+"%"),$("#progbarWidth").width(t+"%")}}e.preventDefault();var s=$(this);$(this).attr("name");$("#progbarWidth").width(0);var o=$(this).attr("name")+"-process";$(".message span").hide();var a=new FormData(this),n=$(this).data("reset");return $.ajax({data:a,type:"POST",url:site_url+"ajax.php?process="+o,xhr:function(){return myXhr=$.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",t,!1),myXhr},success:function(e){"yes"==n&&$(s)[0].reset(),$(s).next(".message").next("#progress").hide("fast"),$(s).find(".message").slideDown(500,function(){$(s).find(".message").html(e)}),$(".message span").delay(1e4).slideUp(2e3,function(){$(".message span").remove()})},error:function(e,t,s){},complete:function(){},cache:!1,contentType:!1,processData:!1}),$(s).next(".message").after("<div id='progress'><div id='progbarWidth'></div></div>"),!1}),$("body").on("click","button#cancel-submit",function(e){var t=$("#quick-book-panel form.api"),s=function(){var e=document.cookie.match(/PHPSESSID=[^;]+/);return null!=e&&(e=e instanceof Array?e[0].substring(11):e.substring(11)),e}();$.ajax({data:t.serialize()+"&session="+s,type:"POST",url:site_url+"ajax.php?process=statistics-process",success:function(e){!0===debug&&console.log("response: "+e);JSON.parse(e).status},error:function(e,t,s){},complete:function(){}})})});